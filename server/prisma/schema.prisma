generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

enum PlanType {
  FREE
  BASIC
  PRO
}

enum Role {
  USER
  ADMIN
}

enum RenderStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

model NexrenderTemplate {
  id           String @id @default(uuid())
  templateId   Int    @unique
  nexrenderId  String @unique
  displayName  String
  status       String
  compositions Json
  layers       Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("nexrender_templates")
}

model RenderJob {
  id                 String       @id @default(uuid())
  userId             String
  templateId         Int
  status             RenderStatus @default(PENDING)
  nexrenderJobId     String?      @unique
  outputUrl          String?
  nexrenderOutputUrl String?
  error              String?
  customizations     Json

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("render_jobs")
}

model User {
  id        String   @id @default(uuid())
  fullName  String
  email     String   @unique
  password  String?
  role      Role     @default(USER)
  avatar    String?  @default("")
  planType  PlanType @default(FREE)
  provider  String   @default("email")
  googleId  String?  @unique
  appleId   String?  @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  stripeCustomerId       String?   @unique
  stripeSubscriptionId   String?   @unique
  stripePriceId          String?
  stripeCurrentPeriodEnd DateTime?

  renderJobs RenderJob[]
  credits    Int         @default(0)

  @@map("users")
}
